$schema: "http://json-schema.org/draft-07/schema#"
$id: "https://agentforge.dev/schemas/conformance_report.schema.yaml"
title: "Conformance Report"
description: |
  Current conformance state for a repository. Generated by conformance check,
  provides summary view without parsing individual violation files.

type: object
required:
  - schema_version
  - generated_at
  - run_id
  - run_type
  - summary
  - by_severity
  - by_contract
  - contracts_checked
  - files_checked

properties:
  schema_version:
    type: string
    pattern: "^\\d+\\.\\d+$"
    description: "Schema version for migration support"
    examples: ["1.0"]

  generated_at:
    type: string
    format: date-time
    description: "ISO 8601 timestamp of report generation"

  run_id:
    type: string
    format: uuid
    description: "Unique identifier for this verification run"

  run_type:
    type: string
    enum: [full, incremental]
    description: "Whether this was a full or incremental run"

  summary:
    type: object
    required: [total, passed, failed, exempted, stale]
    properties:
      total:
        type: integer
        minimum: 0
        description: "Total checks executed"
      passed:
        type: integer
        minimum: 0
        description: "Checks that passed"
      failed:
        type: integer
        minimum: 0
        description: "Checks that failed (open violations)"
      exempted:
        type: integer
        minimum: 0
        description: "Violations covered by exemptions"
      stale:
        type: integer
        minimum: 0
        description: "Violations not re-checked this run"

  by_severity:
    type: object
    description: "Violation counts by severity level"
    properties:
      blocker:
        type: integer
        minimum: 0
      critical:
        type: integer
        minimum: 0
      major:
        type: integer
        minimum: 0
      minor:
        type: integer
        minimum: 0
      info:
        type: integer
        minimum: 0

  by_contract:
    type: object
    description: "Violation counts by contract ID"
    additionalProperties:
      type: integer
      minimum: 0

  contracts_checked:
    type: array
    items:
      type: string
    description: "List of contract IDs included in this run"

  files_checked:
    type: integer
    minimum: 0
    description: "Count of files analyzed"

  trend:
    type: object
    description: "Comparison with previous run"
    properties:
      passed_delta:
        type: integer
      failed_delta:
        type: integer
      exempted_delta:
        type: integer
      previous_run_id:
        type: string
        format: uuid

additionalProperties: false

examples:
  - schema_version: "1.0"
    generated_at: "2025-01-15T14:30:00Z"
    run_id: "550e8400-e29b-41d4-a716-446655440000"
    run_type: "full"
    summary:
      total: 100
      passed: 85
      failed: 10
      exempted: 5
      stale: 0
    by_severity:
      blocker: 2
      critical: 3
      major: 5
      minor: 0
      info: 0
    by_contract:
      "agentforge": 7
      "security-baseline": 3
    contracts_checked:
      - "agentforge"
      - "security-baseline"
    files_checked: 45
    trend:
      passed_delta: 5
      failed_delta: -3
      exempted_delta: 0
      previous_run_id: "550e8400-e29b-41d4-a716-446655440001"
