# Architecture Rules Schema
# Validates: config/architecture.yaml

$schema: "http://json-schema.org/draft-07/schema#"
$id: "https://agentforge.dev/schemas/architecture.schema.yaml"
title: ArchitectureRules
description: Project architecture constraints and coding standards

type: object
required:
  - project
  - layers
additionalProperties: false

properties:
  project:
    type: object
    required:
      - name
    additionalProperties: false
    properties:
      name:
        type: string
      type:
        type: string
        enum: [web-api, console, library, desktop, mobile]
      framework:
        type: string
      version:
        type: string

  layers:
    type: object
    description: Architecture layer definitions
    additionalProperties:
      type: object
      required:
        - path
        - allowed_dependencies
      properties:
        path:
          type: string
        description:
          type: string
        allowed_dependencies:
          type: array
          items:
            type: string

  dependency_rules:
    type: array
    description: Layer dependency rules
    items:
      type: object
      required:
        - id
        - rule
        - from_layer
        - to_layer
        - allowed
      additionalProperties: false
      properties:
        id:
          type: string
          pattern: "^[A-Z]+-[0-9]+$"
        rule:
          type: string
        from_layer:
          type: string
        to_layer:
          type: string
        allowed:
          type: boolean
        severity:
          type: string
          enum: [blocking, warning, info]
          default: blocking

  patterns:
    type: object
    description: Required coding patterns
    additionalProperties:
      type: object
      required:
        - name
        - description
      properties:
        name:
          type: string
        description:
          type: string
        applies_to:
          type: array
          items:
            type: string
        examples:
          type: array
          items:
            type: string
        anti_patterns:
          type: array
          items:
            type: string
        interface_location:
          type: string
        implementation_location:
          type: string
        naming:
          type: object
          additionalProperties:
            type: string
        command_suffix:
          type: string
        query_suffix:
          type: string
        handler_suffix:
          type: string

  naming:
    type: object
    description: Naming conventions
    additionalProperties: false
    properties:
      namespaces:
        type: object
        properties:
          root:
            type: string
          pattern:
            type: string
      classes:
        type: object
        additionalProperties:
          type: string
      files:
        type: object
        properties:
          one_class_per_file:
            type: boolean
          filename_matches_classname:
            type: boolean

  testing:
    type: object
    additionalProperties: false
    properties:
      required_coverage:
        type: object
        additionalProperties:
          type: integer
          minimum: 0
          maximum: 100
      patterns:
        type: object
        properties:
          unit_test_suffix:
            type: string
          integration_test_suffix:
            type: string
          test_naming:
            type: string

  quality:
    type: object
    additionalProperties: false
    properties:
      max_method_lines:
        type: integer
        minimum: 10
        maximum: 200
      max_class_lines:
        type: integer
        minimum: 50
        maximum: 1000
      max_parameters:
        type: integer
        minimum: 1
        maximum: 20
      max_cyclomatic_complexity:
        type: integer
        minimum: 1
        maximum: 50
      required_documentation:
        type: object
        additionalProperties:
          type: boolean

  forbidden:
    type: array
    description: Forbidden code patterns
    items:
      type: object
      required:
        - pattern
        - description
      additionalProperties: false
      properties:
        pattern:
          type: string
          description: Regex pattern to detect
        description:
          type: string
        severity:
          type: string
          enum: [blocking, warning, info]
          default: warning
