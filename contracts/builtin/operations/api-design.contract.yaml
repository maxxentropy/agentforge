schema_version: '2.0'
contract:
  name: api-design
  type: operations
  description: 'Comprehensive API design patterns covering REST conventions,

    request/response formats, versioning, and error handling.

    '
  version: 1.0.0
  enabled: false  # Disabled - check types not yet implemented
  tags:
  - builtin
  - operations
  - code-quality
checks:
- id: resource-naming
  name: Use noun-based, plural resource names
  description: Use noun-based, plural resource names
  type: naming_convention
  severity: warning
  enabled: false  # Disabled - check types not yet implemented
  config:
    patterns:
      resources: plural_nouns
      collections:
      - /users
      - /orders
      - /products
      items:
      - /users/{id}
      - /orders/{order_id}
      nested:
      - /users/{id}/orders
      - /orders/{id}/items
    avoid:
    - verbs_in_urls
    - singular_collections
    - action_endpoints
    bad_examples:
    - /getUsers
    - /createOrder
    - /user
    - /doSomething
    exceptions:
    - controller_resources
    - batch_operations
  rationale: 'REST treats URLs as resource identifiers, not actions.

    Nouns describe what you''re working with, verbs go in HTTP methods.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: http-method-semantics
  name: Use HTTP methods according to their semantics
  description: Use HTTP methods according to their semantics
  type: api_pattern
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    methods:
      GET:
        purpose: Retrieve resource(s)
        safe: true
        idempotent: true
        body: never
      POST:
        purpose: Create resource or trigger action
        safe: false
        idempotent: false
        body: required
      PUT:
        purpose: Replace entire resource
        safe: false
        idempotent: true
        body: required
      PATCH:
        purpose: Partial update
        safe: false
        idempotent: false
        body: required
      DELETE:
        purpose: Remove resource
        safe: false
        idempotent: true
        body: rarely
    anti_patterns:
    - POST_for_retrieval
    - GET_with_body
    - DELETE_returning_deleted_resource
  rationale: 'HTTP methods have defined semantics. Violating them breaks

    caching, proxies, and client expectations.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: status-code-usage
  name: Use appropriate HTTP status codes
  description: Use appropriate HTTP status codes
  type: api_pattern
  severity: warning
  enabled: false  # Disabled - check types not yet implemented
  config:
    categories:
      2xx_success:
        200: OK - general success
        201: Created - resource created
        202: Accepted - async processing started
        204: No Content - success with no body
      4xx_client_error:
        400: Bad Request - malformed request
        401: Unauthorized - authentication required
        403: Forbidden - insufficient permissions
        404: Not Found - resource doesn't exist
        409: Conflict - state conflict
        422: Unprocessable Entity - validation failed
        429: Too Many Requests - rate limited
      5xx_server_error:
        500: Internal Server Error - unexpected failure
        502: Bad Gateway - upstream failure
        503: Service Unavailable - temporarily down
        504: Gateway Timeout - upstream timeout
    anti_patterns:
    - 200_for_errors
    - 500_for_validation
    - 404_for_empty_list
  rationale: 'Status codes are the first thing clients check. Incorrect

    codes break error handling and monitoring.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: request-validation
  name: Validate all request inputs
  description: Validate all request inputs
  type: api_pattern
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    validate:
    - path_parameters
    - query_parameters
    - request_headers
    - request_body
    validation_order:
      1: authentication
      2: authorization
      3: rate_limiting
      4: input_validation
      5: business_rules
    reject_early: true
    return_all_errors: true
  rationale: 'Validation at the edge prevents invalid data from

    propagating through the system.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: query-parameters
  name: Design query parameters for filtering and paginati
  description: Design query parameters for filtering and pagination
  type: api_pattern
  severity: warning
  enabled: false  # Disabled - check types not yet implemented
  config:
    filtering:
      pattern: ?field=value&field2=value2
      operators:
      - eq
      - ne
      - gt
      - lt
      - gte
      - lte
      - in
      - contains
      example: ?status=active&created_at_gte=2024-01-01
    pagination:
      prefer: cursor_based
      allow: offset_limit
      parameters:
        cursor:
        - cursor
        - after
        - before
        offset:
        - offset
        - skip
        limit:
        - limit
        - page_size
        - per_page
      max_limit: 100
      default_limit: 20
    sorting:
      parameter: sort
      format: field:asc,field2:desc
      example: ?sort=created_at:desc,name:asc
  rationale: 'Consistent query parameter conventions make APIs predictable.

    Cursor pagination handles large datasets better.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: request-body-format
  name: Request bodies should be consistent and typed
  description: Request bodies should be consistent and typed
  type: api_pattern
  severity: warning
  enabled: false  # Disabled - check types not yet implemented
  config:
    format:
      prefer: application/json
      support:
      - application/json
      - multipart/form-data
    structure:
      flat_preferred: true
      max_nesting: 3
      snake_case: true
    avoid:
    - deeply_nested_objects
    - mixed_case_conventions
    - arrays_at_root
  rationale: 'Consistent request formats reduce client implementation

    complexity and documentation burden.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: response-envelope
  name: Use consistent response structure
  description: Use consistent response structure
  type: api_pattern
  severity: warning
  enabled: false  # Disabled - check types not yet implemented
  config:
    success_response:
      single_resource:
        structure:
          data: The resource object
          meta: Optional metadata
        example: "{\n  \"data\": {\"id\": \"123\", \"name\": \"Example\"},\n  \"meta\": {\"request_id\"\
          : \"abc-123\"}\n}\n"
      collection:
        structure:
          data: Array of resources
          meta: Pagination info
          links: Navigation links
        example: "{\n  \"data\": [{\"id\": \"1\"}, {\"id\": \"2\"}],\n  \"meta\": {\"total\": 100, \"\
          page\": 1},\n  \"links\": {\"next\": \"/users?cursor=abc\"}\n}\n"
    alternatives:
    - direct_resource: Return resource directly without envelope
    - jsonapi: Follow JSON:API specification
  rationale: 'Consistent response structure makes client parsing predictable

    and allows for metadata without changing resource schema.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: error-response-format
  name: Error responses must be informative and consistent
  description: Error responses must be informative and consistent
  type: api_pattern
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    structure:
      error:
        code: Machine-readable error code
        message: Human-readable message
        details: Optional additional context
        field_errors: For validation errors
    example: "{\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Request validation\
      \ failed\",\n    \"details\": {\n      \"field_errors\": [\n        {\"field\": \"email\", \"message\"\
      : \"Invalid email format\"},\n        {\"field\": \"age\", \"message\": \"Must be positive\"}\n\
      \      ]\n    }\n  }\n}\n"
    include:
    - request_id_for_tracing
    - documentation_link
    avoid:
    - stack_traces_in_production
    - internal_error_details
    - different_formats_per_error
  rationale: 'Consistent error formats enable systematic error handling.

    Good errors help developers debug integration issues.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: hateoas-links
  name: Include hypermedia links where appropriate
  description: Include hypermedia links where appropriate
  type: api_pattern
  severity: info
  enabled: false  # Disabled - check types not yet implemented
  config:
    when_to_use:
    - pagination_navigation
    - related_resource_discovery
    - available_actions
    link_format:
      self: Link to current resource
      next: Link to next page
      prev: Link to previous page
      related: Links to related resources
    example: "{\n  \"data\": {...},\n  \"links\": {\n    \"self\": \"/users/123\",\n    \"orders\": \"\
      /users/123/orders\",\n    \"next\": \"/users?cursor=xyz\"\n  }\n}\n"
  rationale: 'Hypermedia links make APIs more discoverable and reduce

    client-side URL construction.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: api-versioning
  name: Version APIs to enable evolution
  description: Version APIs to enable evolution
  type: api_pattern
  severity: warning
  enabled: false  # Disabled - check types not yet implemented
  config:
    strategies:
      url_path:
        format: /v1/users
        examples:
        - /v1/users
        - /v2/users
        pros:
        - explicit
        - easy to route
        cons:
        - breaks resource identity
      header:
        format: 'Accept: application/vnd.api+json;version=1'
        pros:
        - clean URLs
        - content negotiation
        cons:
        - harder to test
        - less visible
      query_param:
        format: ?version=1
        pros:
        - easy to switch
        cons:
        - pollutes query string
    recommended: url_path
    rules:
    - never_break_existing_version
    - deprecate_before_remove
    - support_n_minus_1_version
  rationale: 'Versioning enables API evolution while maintaining backward

    compatibility for existing clients.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: breaking-change-policy
  name: Define what constitutes breaking changes
  description: Define what constitutes breaking changes
  type: api_pattern
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    breaking_changes:
    - removing_field
    - renaming_field
    - changing_field_type
    - removing_endpoint
    - changing_url_structure
    - adding_required_field
    - changing_error_format
    non_breaking_changes:
    - adding_optional_field
    - adding_new_endpoint
    - adding_new_enum_value
    - relaxing_validation
    migration_requirements:
    - deprecation_notice
    - migration_guide
    - overlap_period
  rationale: 'Clear rules prevent accidental breaking changes and help

    plan API evolution.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: authentication-pattern
  name: Implement standard authentication patterns
  description: Implement standard authentication patterns
  type: security_pattern
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    methods:
      bearer_token:
        header: 'Authorization: Bearer {token}'
        use_for:
        - api_clients
        - mobile_apps
        - spa
      api_key:
        header: 'X-API-Key: {key}'
        use_for:
        - server_to_server
        - simple_integrations
      basic_auth:
        header: 'Authorization: Basic {base64}'
        use_for:
        - legacy_systems
        - internal_tools
    requirements:
    - use_https_only
    - validate_on_every_request
    - rotate_credentials_periodically
    - rate_limit_auth_failures
  rationale: 'Consistent authentication patterns are essential for security

    and integration simplicity.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: authorization-response
  name: Return appropriate authorization errors
  description: Return appropriate authorization errors
  type: security_pattern
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    responses:
      unauthenticated:
        status: 401
        code: UNAUTHENTICATED
        message: Authentication required
      unauthorized:
        status: 403
        code: FORBIDDEN
        message: Insufficient permissions
      not_found_or_forbidden:
        prefer: 404
        reason: Don't reveal existence of resources
    include:
    - required_permissions
    - how_to_get_access
  rationale: 'Clear auth errors help developers debug access issues

    while not leaking sensitive information.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: rate-limiting-headers
  name: Communicate rate limits clearly
  description: Communicate rate limits clearly
  type: api_pattern
  severity: warning
  enabled: false  # Disabled - check types not yet implemented
  config:
    headers:
      X-RateLimit-Limit: Requests allowed per window
      X-RateLimit-Remaining: Requests remaining in window
      X-RateLimit-Reset: Unix timestamp when window resets
      Retry-After: Seconds to wait (when 429)
    response_when_limited:
      status: 429
      body:
        error:
          code: RATE_LIMITED
          message: Too many requests
          retry_after: 60
  rationale: 'Rate limit headers help clients implement proper backoff

    and avoid unnecessary retries.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: openapi-documentation
  name: Document APIs with OpenAPI/Swagger
  description: Document APIs with OpenAPI/Swagger
  type: documentation
  severity: warning
  enabled: false  # Disabled - check types not yet implemented
  config:
    required:
    - operation_summary
    - request_body_schema
    - response_schemas
    - error_responses
    - authentication_requirements
    recommended:
    - example_requests
    - example_responses
    - parameter_descriptions
    - deprecation_notices
    keep_in_sync: true
  rationale: 'OpenAPI documentation enables automated client generation,

    testing, and interactive exploration.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: api-changelog
  name: Maintain API changelog
  description: Maintain API changelog
  type: documentation
  severity: info
  enabled: false  # Disabled - check types not yet implemented
  config:
    include:
    - version_number
    - release_date
    - breaking_changes
    - new_features
    - deprecations
    - migration_instructions
    format:
      prefer: CHANGELOG.md
      alternative: /api/changelog endpoint
  rationale: 'Changelogs help API consumers track changes and plan

    for migrations.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
escalation_triggers:
- trigger_id: breaking-change-detected
  condition: API change would break existing clients
  severity: blocking
  prompt: 'Breaking API change detected:

    - Review impact on existing clients

    - Consider versioning strategy

    - Plan deprecation and migration

    '
  rationale: 'Breaking changes affect all consumers. Must be

    intentional and well-communicated.

    '
- trigger_id: inconsistent-api-pattern
  condition: New endpoint deviates from existing patterns
  severity: advisory
  prompt: 'New API endpoint uses different patterns:

    - Align with existing conventions

    - Document why deviation is necessary

    - Consider updating existing endpoints

    '
  rationale: 'API consistency is more important than local

    optimization. Deviations add cognitive load.

    '
- trigger_id: missing-error-handling
  condition: Endpoint doesn't handle all error cases
  severity: advisory
  prompt: 'API endpoint may not handle all error cases:

    - Add validation error responses

    - Handle not found cases

    - Consider authorization errors

    '
  rationale: 'Complete error handling prevents unexpected

    client failures.

    '
quality_gates:
- gate_id: api-design-review
  checks:
  - RESTful conventions followed
  - Consistent naming patterns
  - Proper status codes
  - Error responses documented
  - Authentication implemented
  failure_action: escalate
- gate_id: api-documentation-review
  checks:
  - OpenAPI spec complete
  - Examples provided
  - Error cases documented
  - Authentication documented
  failure_action: advisory
