# Generated by AgentForge
# Spec: agent_monitor
# Phase: green
# Date: 2025-12-31 05:34:34 UTC

"""Domain entities for agent monitoring observations and detections."""

from datetime import datetime
from enum import Enum
from typing import Optional
from dataclasses import dataclass


class ObservationType(Enum):
    """Types of observable agent events."""
    ACTION = "action"
    OUTPUT = "output"
    VERIFICATION = "verification"
    STATE_CHANGE = "state_change"
    ERROR = "error"


@dataclass
class Observation:
    """A single observed agent event."""
    type: ObservationType
    timestamp: datetime
    data: dict
    context: Optional[str] = None


class HealthStatus(Enum):
    """Overall agent health status."""
    HEALTHY = "healthy"
    DEGRADED = "degraded"
    CRITICAL = "critical"


class Recommendation(Enum):
    """Recommended action based on health."""
    CONTINUE = "continue"
    CHECKPOINT = "checkpoint"
    ESCALATE = "escalate"
    ABORT = "abort"


@dataclass
class LoopDetection:
    """Result of loop detection analysis."""
    detected: bool
    pattern: Optional[str] = None
    count: int = 0
    observations: list[Observation] = None
    
    def __post_init__(self):
        if self.observations is None:
            self.observations = []


@dataclass
class ThrashingDetection:
    """Result of thrashing detection analysis."""
    detected: bool
    pattern: Optional[str] = None
    affected_files: list[str] = None
    alternation_count: int = 0
    
    def __post_init__(self):
        if self.affected_files is None:
            self.affected_files = []


@dataclass
class AgentHealth:
    """Complete health assessment of agent."""
    status: HealthStatus
    issues: list[str]
    recommendation: Recommendation
    loop_detection: Optional[LoopDetection] = None
    thrashing_detection: Optional[ThrashingDetection] = None
    drift_score: float = 0.0
    context_pressure: float = 0.0
    progress_score: float = 0.0
    
    def __post_init__(self):
        if self.issues is None:
            self.issues = []
