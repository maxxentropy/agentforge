schema_version: '2.0'
contract:
  name: safety
  type: operations
  description: Safety constraints that always apply
  version: 1.0.0
  enabled: false  # Disabled - check types not yet implemented
  tags:
  - builtin
  - operations
  - code-quality
checks:
- id: no-secrets-in-code
  name: Never commit secrets or credentials
  description: Never commit secrets or credentials
  type: content_constraint
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    patterns:
    - api[_-]?key\s*[:=]\s*['"][^'"]{10,}
    - secret\s*[:=]\s*['"][^'"]{10,}
    - password\s*[:=]\s*['"][^'"]{4,}
    - token\s*[:=]\s*['"][^'"]{10,}
    - '-----BEGIN (RSA |DSA |EC |OPENSSH )?PRIVATE KEY-----'
    - AKIA[0-9A-Z]{16}
    excluded_files:
    - '*.example'
    - '*.template'
    - test_*.py
    - '*_test.go'
    action: block_commit
  rationale: 'Secrets in code are a critical security vulnerability.

    Use environment variables or secret management instead.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: no-destructive-system
  name: Avoid destructive shell commands
  description: Avoid destructive shell commands
  type: command_constraint
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    forbidden_patterns:
    - rm -rf /
    - rm -rf ~
    - rm -rf /*
    - '> /dev/sd'
    - mkfs\.
    - ':(){:|:&};:'
    forbidden_directories:
    - /
    - /etc
    - /usr
    - /var
    - /bin
    - /sbin
    - /boot
    - '~'
    - $HOME
  rationale: 'Destructive system commands can cause irreversible damage.

    These patterns are almost never appropriate for application code.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: no-chmod-777
  name: Don't grant excessive permissions
  description: Don't grant excessive permissions
  type: command_constraint
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    forbidden_patterns:
    - chmod 777
    - chmod -R 777
    - chmod a+rwx
  rationale: 'World-writable files are a security risk. Use specific

    permissions (644 for files, 755 for executables).

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: no-sudo-without-approval
  name: Sudo requires explicit approval
  description: Sudo requires explicit approval
  type: command_constraint
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    pattern: ^sudo
    unless: explicitly_approved
  rationale: 'Elevated privileges can cause system-wide damage.

    Human approval required for any privileged operations.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: preserve-existing-tests
  name: Don't delete tests without explanation
  description: Don't delete tests without explanation
  type: deletion_constraint
  severity: warning
  enabled: false  # Disabled - check types not yet implemented
  config:
    protected_patterns:
    - test_*.py
    - '*_test.py'
    - '*_test.go'
    - '*.test.js'
    - '*.test.ts'
    - '*.spec.js'
    - '*.spec.ts'
    action: require_explanation
  rationale: 'Tests are critical for code quality. Deletions should be

    intentional and explained, not accidental.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: no-disable-security
  name: Don't disable security features
  description: Don't disable security features
  type: content_constraint
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    patterns:
    - verify\s*=\s*False
    - ssl[_-]verify.*false
    - CURLOPT_SSL_VERIFYPEER.*false
    - disable-ssl
    - no-verify-ssl
    - insecure
    action: escalate
  rationale: 'Disabling security features (like SSL verification) creates

    vulnerabilities. Should only be done with explicit approval.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: no-eval-user-input
  name: Don't eval untrusted input
  description: Don't eval untrusted input
  type: code_pattern
  severity: error
  enabled: false  # Disabled - check types not yet implemented
  config:
    dangerous_patterns:
    - eval\(.*request
    - eval\(.*input
    - exec\(.*request
    - exec\(.*input
    - __import__\(.*request
    - subprocess.*shell=True.*request
    action: escalate
  rationale: 'Evaluating user input leads to code injection vulnerabilities.

    Always sanitize and validate inputs.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
- id: backup-before-bulk
  name: Backup before bulk destructive operations
  description: Backup before bulk destructive operations
  type: operation_guard
  severity: warning
  enabled: false  # Disabled - check types not yet implemented
  config:
    operations:
    - DELETE FROM .* WHERE
    - DROP TABLE
    - TRUNCATE
    - rm -rf
    require: backup_confirmation
  rationale: 'Bulk deletions are hard to undo. Having a backup

    provides recovery options if something goes wrong.

    '
  applies_to:
    paths:
    - '**/*.py'
    exclude_paths:
    - '**/node_modules/**'
    - '**/venv/**'
    - '**/__pycache__/**'
escalation_triggers:
- trigger_id: security-sensitive-op
  condition: Any security-sensitive operation detected
  severity: blocking
  prompt: 'Security-sensitive operation detected:

    {operation}


    This requires human approval before proceeding.

    Please confirm this is intentional and secure.

    '
  rationale: Security decisions should always involve human judgment
- trigger_id: potential-secret-exposure
  condition: Content matching secret patterns detected
  severity: blocking
  prompt: 'Potential secret detected:

    File: {file}

    Pattern: {pattern}


    Is this a real secret or a false positive?

    If real, it should be moved to environment variables.

    '
  rationale: Secret exposure is a critical security risk
- trigger_id: destructive-file-op
  condition: Bulk file deletion requested
  severity: blocking
  prompt: 'Destructive file operation requested:

    {operation}

    Affected: {count} files


    Please confirm this is intentional.

    Consider creating a backup first.

    '
  rationale: Bulk deletions are difficult to reverse
- trigger_id: permission-change
  condition: File permission modification requested
  severity: advisory
  prompt: 'Permission change requested:

    {operation}


    Verify these permissions are appropriate for the file type.

    '
  rationale: Incorrect permissions can create security vulnerabilities
quality_gates:
- gate_id: security-review
  checks:
  - No secrets in committed code
  - No disabled security features
  - No dangerous eval patterns
  - Permissions are appropriate
  failure_action: escalate
- gate_id: pre-deploy-safety
  checks:
  - All safety rules pass
  - No pending security escalations
  - No destructive operations pending
  failure_action: abort
