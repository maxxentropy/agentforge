# ═══════════════════════════════════════════════════════════════════════════════
# Specification: generate
# ═══════════════════════════════════════════════════════════════════════════════
# Generated: 2026-01-01T16:08:00.103383
# Generator: brownfield-discovery
# ═══════════════════════════════════════════════════════════════════════════════

spec_id: generate-v1
name: generate
version: '1.0'
status: as-built
schema_version: '2.0'
generated_at: '2026-01-01T16:08:00.103383'
generated_by: brownfield-discovery
description: Specification for tools/generate
components:
- name: domain
  component_id: tools-generate-domain
  location: tools/generate/domain.py
  test_location: tests/unit/tools/test_builtin_checks_architecture.py
  description: 'LLM Generation Domain Model

    ===========================


    Core domain entities for LLM-powered code generation.'
  entities:
  - name: GenerationPhase
    type: enum
    line_number: 15
    description: Phases of code generation in TDD workflow.
    methods: []
    test_methods: []
  - name: GenerationMode
    type: enum
    line_number: 23
    description: Mode of code generation.
    methods: []
    test_methods: []
  - name: FileAction
    type: enum
    line_number: 31
    description: Action to take on a generated file.
    methods: []
    test_methods: []
  - name: GenerationError
    type: class
    line_number: 44
    description: Base exception for generation errors.
    methods: []
    test_methods: []
  - name: APIError
    type: class
    line_number: 53
    description: Error from LLM API call.
    methods: []
    test_methods: []
  - name: ParseError
    type: class
    line_number: 69
    description: Error parsing LLM response.
    methods: []
    test_methods: []
  - name: WriteError
    type: class
    line_number: 83
    description: Error writing generated files.
    methods: []
    test_methods: []
  - name: TokenUsage
    type: dataclass
    line_number: 103
    description: Token usage statistics from LLM call.
    methods:
    - total_tokens
    - cost_estimate
    test_methods: []
  - name: GeneratedFile
    type: dataclass
    line_number: 129
    description: A file generated by the LLM.
    methods:
    - is_new
    - is_modification
    - line_count
    - diff_summary
    test_methods: []
  - name: GenerationContext
    type: dataclass
    line_number: 170
    description: Context for code generation request.
    methods:
    - for_red
    - for_green
    - for_fix
    - for_refactor
    test_methods: []
  - name: GenerationResult
    type: dataclass
    line_number: 259
    description: Result of a code generation request.
    methods:
    - tokens_used
    - prompt_tokens
    - completion_tokens
    - file_count
    - total_lines
    - failure
    - success_result
    - summary
    test_methods: []
- name: parser
  component_id: tools-generate-parser
  location: tools/generate/parser.py
  test_location: tests/unit/tools/generate/test_parser.py
  description: 'Response Parser

    ===============


    Extracts code files from LLM responses.

    Handles markdown code blocks with file path markers.'
  entities:
  - name: ResponseParser
    type: class
    line_number: 17
    description: 'Parses LLM responses to extract generated code files.


      Expects code blocks in the format:

      ```python:path/to/file.py

      # code here

      ```


      Also supports language-only blocks that are associated with

      a file path mentioned in the surrounding text.'
    methods:
    - parse
    - extract_explanation
    - parse_with_explanation
    test_methods: []
  - name: MultiLanguageParser
    type: class
    line_number: 222
    description: 'Extended parser that handles multiple languages.


      Supports Python, TypeScript, C#, and other common languages.'
    methods:
    - parse
    test_methods: []
  - name: parse_response
    type: function
    line_number: 283
    description: "Convenience function to parse LLM response.\n\nArgs:\n    response:\
      \ Raw LLM response text\n    validate_syntax: Whether to validate Python syntax\n\
      \nReturns:\n    List of GeneratedFile objects\n\nRaises:\n    ParseError: If\
      \ no valid code files found"
    methods: []
    test_methods: []
- name: prompt_builder
  component_id: tools-generate-prompt_builder
  location: tools/generate/prompt_builder.py
  test_location: tests/unit/tools/generate/test_engine.py
  description: 'Prompt Builder

    ==============


    Assembles LLM prompts from GenerationContext.

    Uses XML structure for clear separation of concerns.'
  entities:
  - name: PromptBuilder
    type: class
    line_number: 17
    description: 'Builds prompts for LLM code generation.


      Uses XML structure for:

      - Clear section boundaries

      - Easy parsing by LLMs

      - Consistent formatting'
    methods:
    - build
    - estimate_tokens
    test_methods: []
  - name: PromptTemplates
    type: class
    line_number: 332
    description: 'Pre-built prompt templates for common scenarios.


      Use these as starting points or for simple cases.'
    methods:
    - simple_test_prompt
    - simple_impl_prompt
    test_methods: []
- name: provider
  component_id: tools-generate-provider
  location: tools/generate/provider.py
  test_location: tests/unit/tools/generate/test_engine.py
  description: 'LLM Provider Abstraction

    ========================


    Abstract base class and implementations for LLM providers.'
  entities:
  - name: LLMProvider
    type: class
    line_number: 19
    description: 'Abstract base class for LLM providers.


      Implementations handle specific LLM APIs (Claude, OpenAI, etc.)

      or manual fallback modes.'
    methods:
    - count_tokens
    - model_name
    - is_available
    test_methods: []
  - name: ClaudeProvider
    type: class
    line_number: 75
    description: 'Claude API provider using the Anthropic SDK.


      Features:

      - Async API calls

      - Automatic retry with exponential backoff

      - Token usage tracking

      - Model selection'
    methods:
    - model_name
    - is_available
    - count_tokens
    test_methods: []
  - name: ManualProvider
    type: class
    line_number: 224
    description: 'Manual fallback provider for when no API key is available.


      Writes prompt to a file and reads response from a file,

      allowing the user to manually obtain the LLM response.'
    methods:
    - model_name
    - is_available
    - count_tokens
    test_methods: []
  - name: get_provider
    type: function
    line_number: 332
    description: "Get the appropriate LLM provider.\n\nReturns ClaudeProvider if API\
      \ key is available, otherwise ManualProvider.\nAutomatically loads .env file\
      \ if python-dotenv is available.\n\nArgs:\n    model: Model to use (for ClaudeProvider)\n\
      \    api_key: API key (defaults to ANTHROPIC_API_KEY env var)\n\nReturns:\n\
      \    Configured LLMProvider instance"
    methods: []
    test_methods: []
  - name: get_provider_sync
    type: function
    line_number: 360
    description: 'Synchronous version of get_provider.


      Provided for convenience in non-async contexts.'
    methods: []
    test_methods: []
- name: engine
  component_id: tools-generate-engine
  location: tools/generate/engine.py
  test_location: tests/unit/tools/generate/test_engine.py
  description: 'Generation Engine

    ==================


    Main orchestrator for LLM code generation.

    Combines provider, prompt builder, parser, and writer.'
  entities:
  - name: GenerationEngine
    type: class
    line_number: 30
    description: 'Main engine for LLM code generation.


      Orchestrates the full generation workflow:

      1. Build prompt from context

      2. Call LLM provider

      3. Parse response into files

      4. Write files to disk

      5. Return result


      Handles errors gracefully at each step with appropriate

      recovery strategies.'
    methods:
    - generate_sync
    test_methods: []
  - name: GenerationSession
    type: class
    line_number: 217
    description: 'Manages a multi-step generation session.


      Useful for iterative generation (RED -> GREEN -> REFACTOR)

      with shared context and history.'
    methods:
    - total_tokens_used
    - total_files_generated
    - all_succeeded
    - summary
    test_methods: []
  - name: generate_code_sync
    type: function
    line_number: 353
    description: "Synchronous convenience function for one-shot code generation.\n\
      \nArgs:\n    context: Generation context\n    dry_run: Don't write files if\
      \ True\n    project_root: Project root directory\n\nReturns:\n    GenerationResult"
    methods: []
    test_methods: []
- name: writer
  component_id: tools-generate-writer
  location: tools/generate/writer.py
  test_location: tests/unit/tools/generate/test_engine.py
  description: 'Code Writer

    ===========


    Writes generated files to disk with safety features:

    - Atomic writes (temp file + rename)

    - Backup of existing files

    - Rollback capability

    - Header comments for generated files'
  entities:
  - name: WriteOperation
    type: dataclass
    line_number: 24
    description: Record of a single write operation for rollback.
    methods: []
    test_methods: []
  - name: CodeWriter
    type: class
    line_number: 34
    description: 'Writes generated code files to disk.


      Features:

      - Atomic writes using temp file + rename

      - Automatic backup of existing files

      - Rollback to restore original state

      - Optional header comments on generated files'
    methods:
    - set_metadata
    - write
    - rollback
    - clear_history
    - cleanup_backups
    - operation_count
    - has_pending_operations
    test_methods: []
